
pipeline {
    environment {
        APP_NAME = 'angular-test-code'
        JENKINSFILE_LOCATION = 'JenkinsFile'
        DOCKER_REGISTRY = 'gauravmathur1/angular-test-docker'
        VERSION="$BUILD_NUMBER"
        registryCredential = 'dockerhub'
        dockerImage = ''
    }
    agent any
    stages {    
        stage('Docker Build') {
            steps {
                script {
                     dockerImage = docker.build "${DOCKER_REGISTRY}" + ":${VERSION}"
                }
            }
        }
        stage('Docker Run') {
            steps {
               sh "docker run -d -p 8081:80 ""${DOCKER_REGISTRY}" + ":${VERSION}"""
            }
        }
        stage('Image push to Artifactory') {
            steps {
                script {
                         docker.withRegistry( '', registryCredential ) {
                            dockerImage.push()
                        }
                     }
                }
         }
    }
}
